#!/bin/sh
# postinst script for smart_proxy_dynflow
#
# see: dh_installdeb(1)

set -e

USERNAME="foreman-proxy"
GROUPNAME="foreman-proxy"
DYNFLOW_DB_DIR="/var/lib/foreman-proxy/dynflow"
FOREMAN_HOME="/usr/share/foreman-proxy"

case "$1" in
  configure)
    getent group $GROUPNAME >/dev/null || groupadd -r $GROUPNAME
    getent passwd $USERNAME >/dev/null || \
      useradd -r -g $GROUPNAME -d $FOREMAN_HOME -s /usr/sbin/nologin -c "Foreman Proxy daemon user" $USERNAME

    for dir in /var/{log,run}/foreman-proxy $DYNFLOW_DB_DIR; do
        mkdir -p "$dir"
	chown $USERNAME:$GROUPNAME "$dir"
    done

    chmod 750 $DYNFLOW_DB_DIR
  ;;
  abort-upgrade|abort-remove|abort-deconfigure)
  ;;

  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 0
  ;;
esac


# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
